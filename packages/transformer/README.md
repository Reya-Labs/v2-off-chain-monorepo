# Voltz V2 Transformer

TODO: add more info about the transformer once it is built

## Poetry

As soon as you close the monorepoo and navigate to the transformer package for the first time, you should be able to create a new 
virtual environment with Poetry by following these steps:

1. Install Poetry on your system if you haven't already. You can install it using the recommended installer:

```bash
curl -sSL https://install.python-poetry.org | python3
```

This command will download and install Poetry. The installer will also modify your PATH variable to include Poetry's executables.

2. Run the following command in your terminal to create a virtual environment and install the specified dependencies:

```bash
poetry install
```

Poetry will automatically create a new virtual environment in the default location (~/.cache/pypoetry/virtualenvs) and install the dependencies 
specified in the pyproject.toml file.

You can run commands within the virtual environment using poetry run. For example:

```bash
poetry run python my_script.py
```

This will execute my_script.py using the Python interpreter within the virtual environment managed by Poetry.

### Setting up a Poetry project

Getting started with Poetry
This guide will walk you through setting up a Poetry-based Python project. We will go from an empty directory to a fully configured Poetry environment, ready for development.

1. **Install Poetry**: First, you need to install Poetry on your system. You can install it using the recommended installer:
bash

```commandline
curl -sSL https://install.python-poetry.org | python3
```

This command downloads and installs Poetry. The installer also modifies your PATH variable to include Poetry's executables.

2. **Create a new project directory**: Create a new directory for your project and navigate to it in the terminal.

3. **Initialize the project**: Run poetry init in the terminal to create a new pyproject.toml file in your project directory. This file contains your project's dependencies and configurations. Follow the interactive prompts to configure your project.

### Understanding the pyproject.toml file

The pyproject.toml file is the central configuration file for your Poetry project.

Here's the breakdown of the pyproject.toml file that's at the root of this package.

```toml
[tool.poetry]
name = "@voltz-protocol/transformer-v2"
version = "1.0.0"
description = "Voltz V2 Google Dataflow Transformer"
authors = ["Voltz Protocol"]

[tool.poetry.dependencies]
python = "^3.9"
apache-beam = "^2.46.0"
pytest = "^7.1.3"

[tool.poetry.dev-dependencies]
flake8 = "^6.0.0"
black = "^23.3.0"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```
Let's break down each section:

- **[tool.poetry]**: This section contains metadata about your project, such as its name, version, description, and authors.
- **[tool.poetry.dependencies]**: This section lists your project's dependencies. These are the packages required for your project to function correctly. The specified versions use semantic versioning with the caret (^) symbol, indicating compatible versions.
- **[tool.poetry.dev-dependencies]**: This section lists development dependencies. These packages are not needed for your project to function but are useful during development (e.g., linters, formatters, testing libraries).
- **[build-system]**: This section specifies the build requirements and build backend for your project. It ensures that the build system used is compatible with your project's configuration.

### The poetry.lock file

The poetry.lock file is automatically generated by Poetry when you install dependencies. It contains the exact versions of all packages installed in your project, including transitive dependencies (dependencies of your dependencies).

The purpose of the poetry.lock file is to provide a deterministic build across different environments. By locking the exact versions of packages, you ensure that the project will behave consistently on different machines or when collaborators work on the same project.


### Leveraging Poetry for Python development

Poetry is a powerful tool that simplifies dependency management, packaging, and publishing of Python projects. It handles virtual environments, streamlining the development process and making it easier to manage dependencies. Some key features of Poetry include:

1. **Dependency management**: Define your project's dependencies in the pyproject.toml file, and Poetry will handle installation, updates, and resolving conflicts.
2. **Virtual environment management**: Poetry creates and manages virtual environments for your project, isolating dependencies and providing a consistent development environment.
3. **Packaging and publishing**: Poetry can build and package your project, making it easy to distribute and share with others. It also


### Docker Setup

This Dockerfile sets up an environment for running an application that uses the Apache Beam SDK with PyArrow. The main reason for using Docker in this context is to manage the dependencies required to make the Apache Beam SDK work, given its dependency on PyArrow.

The Dockerfile consists of several actions that build the environment step by step. Here's a breakdown of the actions in the Dockerfile:

1. `FROM python:3.11`: This line sets the base image to the official Python 3.11 image.

2. `RUN apt-get update`: This line updates the package list on the base image.

3. `RUN apt-get install -y --no-install-recommends curl cmake make gcc g++`: This line installs the necessary tools and libraries, including curl, cmake, make, GCC, and G++.

4. `RUN curl -sSL https://install.python-poetry.org | python3 -`: This line installs Poetry, a Python dependency management tool.

5. `RUN apt-get purge -y --auto-remove curl`: This line removes curl as it's no longer needed.

6. `ENV PATH="/root/.local/bin:$PATH"`: This line updates the PATH environment variable to include the directory where Poetry was installed.

7. The next few lines install the Arrow library:

   - Install necessary tools for adding the Arrow repository.
   - Add the Apache Arrow repository to the sources list.
   - Update the package list to include the Arrow packages.
   - Install specific versions of libarrow-dev and libarrow-python-dev.

8. `WORKDIR /code`: This line sets the working directory to `/code`.

9. `COPY poetry.lock pyproject.toml /code/`: This line copies the Poetry lock file and the project configuration file to the working directory.

10. `RUN poetry config virtualenvs.create false`: This line configures Poetry to not create virtual environments.

11. `RUN poetry install --no-interaction --no-ansi --no-dev`: This line installs the project dependencies using Poetry.

12. `ENTRYPOINT ["python", "src/main.py"]`: This line sets the entrypoint for running the application.

To build the Docker image, run the following command:

```docker build -t v2-transformer .```

# IO Module

The io folder is meant to hold code related to input and output operations in your pipelines. 
Since we are dealing with Google Pub/Sub topic subscriptions and Google Bigtable, the input.py and output.py files would contain the necessary code for reading from Pub/Sub topic subscriptions and writing to Bigtable.
By separating the I/O operations into their own module, we can reuse them across multiple pipelines and keep the code more organized and maintainable.